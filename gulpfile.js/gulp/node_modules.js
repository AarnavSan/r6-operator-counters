'use strict';

var conf = require('./conf'),
    connect = require('gulp-connect'),
    gulp = require('gulp'),
    gulpWebp = require('gulp-webp'),
    gulpSvg2Png = require('gulp-svg2png'),
    imagemin = require('gulp-imagemin');

// convert the .svgs from the node_module to 500x500 .pngs & compress them - slow
function node_modules_r6operators_png() {
    return gulp.src([
            'node_modules/r6operators/dist/icons/*.*'
        ])
        .pipe(gulpSvg2Png({
            width: "500",
            height: "500",
        }))
        .pipe(imagemin({ optimizationLevel: 3, progressive: true, interlaced: true }))
        .pipe(gulp.dest(conf.paths.dist + '/img/png'))
        .pipe(connect.reload());
};

// convert the .svgs from the node_module to 500x500 .webps & compress them - slow
function node_modules_r6operators_webp(concurrencyLimit = null) {
    return gulp.src([
            'node_modules/r6operators/dist/icons/*.*'
        ])
        .pipe(gulpSvg2Png({
            width: "500",
            height: "500",
        }, false, concurrencyLimit))
        .pipe(gulpWebp())
        .pipe(gulp.dest(conf.paths.dist + '/img/webp'))
        .pipe(connect.reload());
};

// take the .svgs from the module directly
function node_modules_r6operators_svg() {
    return gulp.src([
            'node_modules/r6operators/dist/icons/*.*'
        ])
        .pipe(imagemin({ optimizationLevel: 3, progressive: true, interlaced: true }))
        .pipe(gulp.dest(conf.paths.dist + '/img/svg'))
        .pipe(connect.reload());
};

const node_modules = gulp.series(
    node_modules_r6operators_svg);

const node_modules_production = gulp.series(
    node_modules_r6operators_svg);

exports.default = node_modules;
exports.prod = node_modules_production;